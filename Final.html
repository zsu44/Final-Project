<!DOCTYPE html>
<html>
	<head>
    <title>intro</title>
    
	</head>
	<body>
    
   <script type="module">
 
 //point light shadow code modified from :
 //  https://github.com/saucecode/threejs-demos/blob/master/03_LightAndShadow/demo.js
 //  and https://threejs.org/docs/#api/en/lights/shadows/PointLightShadow

  import * as THREE from './js/build/three.module.js'
  import { OrbitControls } from './js/examples/jsm/controls/OrbitControls.js'
  import { MTLLoader } from "./js/examples/jsm/loaders/MTLLoader.js";
  import { OBJLoader2 } from "/js/examples/jsm/loaders/OBJLoader2.js"; 
  import { MtlObjBridge } from "./js/examples/jsm/loaders/MtlObjBridge.js";

    let scene, camera, renderer, cubes, clock, bustOBJ;
    let meshFloor, ambientLight, light, lightMesh;



    function init() {
      
      clock = new THREE.Clock();
      clock.start();
      
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

      camera.position.set(0, 0.5, -5);
      
      camera.rotation.y = 5
      camera.lookAt(new THREE.Vector3(0, 0, 0));


      renderer = new THREE.WebGLRenderer();

      // Enable Shadows in the Renderer
      renderer.shadowMap.enabled = true;
      //renderer.shadowMap.type = THREE.BasicShadowMap;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;

      renderer.setSize(window.innerWidth, window.innerHeight);
      const canvas = renderer.domElement;
      document.body.appendChild(canvas);

      const controls = new OrbitControls(camera, canvas);


      cubes = [];
        

        const loader = new THREE.TextureLoader();
        const texture = loader.load('./Final/Marble.jpeg');
        const texture2 = loader.load('./Final/wood_floor.jpg');
        const material = new THREE.MeshPhongMaterial({ map: texture }); //map one image to every face
        const material2 = new THREE.MeshPhongMaterial({ map: texture2});

        //Loads  mtf and obj files
        const mtlLoader = new MTLLoader();
      mtlLoader.load('https://raw.githubusercontent.com/zsu44/Final-Project/main/objs/gw_bust/gw_bust-bust-150k-4096.mtl', (mtlParseResult) => {
        const objLoader = new OBJLoader2();
        const materials = MtlObjBridge.addMaterialsFromMtlLoader(mtlParseResult);
        objLoader.addMaterials(materials); 
        
        objLoader.load('https://raw.githubusercontent.com/zsu44/Final-Project/main/objs/gw_bust/npg_70_4_bust-hires_unwrapped-150k-unwrapped.obj', (root) => {
          scene.add(root);
      
      bustOBJ = root; 

        });
    
      });

        let mesh = new THREE.Mesh(
          new THREE.BoxGeometry(1.5, 2, 1),
          material
        );
        mesh.position.y = 1.01         
        
        // The cube can have shadows cast onto it, and it can cast shadows
        mesh.receiveShadow = true;
        mesh.castShadow = true;
        scene.add(mesh);

        cubes.push(mesh);
        //cube #2
        
        let mesh2 = new THREE.Mesh(
          new THREE.BoxGeometry(1, 0.4, 0.7),
          new THREE.MeshPhongMaterial({ color: 0xffffff })
        );

        mesh2.receiveShadow = true;
        mesh2.castShadow = true;
        scene.add(mesh2);

        cubes.push(mesh2);
        
        mesh2.position.y = 2
      

      meshFloor = new THREE.Mesh(
        new THREE.PlaneGeometry(20, 20, 20, 20),
        material2
      );

       meshFloor.rotation.x = - Math.PI / 2.0;
      // Floor can have shadows cast onto it
      meshFloor.receiveShadow = true;
      scene.add(meshFloor);

      
      
      // LIGHTS
      ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
      scene.add(ambientLight);

      light = new THREE.PointLight(0xffffff, 0.8, 18);
      light.position.set(0, 6, -3);
      light.castShadow = true;
      // Will not light anything closer than 0.1 units or further than 25 units
      light.shadow.camera.near = 0.1;
      light.shadow.camera.far = 25;

      //Set up shadow properties for the light
      light.shadow.mapSize.width = 2048; // default is 512
      light.shadow.mapSize.height = 2048; // default is 512
      light.shadow.camera.near = 0.1; // default
      light.shadow.camera.far = 1000; // default

      scene.add(light);


      lightMesh = new THREE.Mesh(
        new THREE.SphereGeometry(0.25),
        new THREE.MeshBasicMaterial({ color: 0xffffff })
      );

      lightMesh.position.set(0, 6, -3);
      scene.add(lightMesh);


      animate();
    }

    let dir = 1;
    function animate() {
      requestAnimationFrame(animate);

      console.log(camera);
      camera.position.y = Math.sin(clock.getElapsedTime() / 20)* 2;
      renderer.render(scene, camera);
      console.log (camera.position.y)
      console.log (clock.elapsedTime);
    }

   init();

  </script>
</body>

</html>